{{#each dataObjectMappings}}{{#if @first}}
--
-- Link Insert Into statement for {{targetDataObject.name}}
--

INSERT INTO [{{lookupExtension targetDataObject.extensions "datastore"}}].[{{lookupExtension targetDataObject.extensions "location"}}].[{{targetDataObject.name}}]
(  {{#each businessKeyDefinitions}}
   [{{surrogateKey}}],{{/each}}{{#each dataItemMappings}}
   [{{targetDataItem.name}}],{{/each}}
   [{{../metadataConfiguration.etlProcessAttribute}}],
   [{{../metadataConfiguration.loadDateTimeAttribute}}]
)
SELECT {{#each businessKeyDefinitions}}
   link_view.[{{surrogateKey}}],{{/each}}{{#each dataItemMappings}}
   link_view.[{{targetDataItem.name}}],{{/each}}
   -1 AS [{{../metadataConfiguration.etlProcessAttribute}}],
   link_view.[{{../metadataConfiguration.loadDateTimeAttribute}}]
FROM [{{../metadataConfiguration.vdwSchemaName}}].[{{targetDataObject.name}}] link_view
LEFT OUTER JOIN [{{lookupExtension targetDataObject.extensions "datastore"}}].[{{lookupExtension targetDataObject.extensions "location"}}].[{{targetDataObject.name}}] link_table
   ON link_view.[{{#each businessKeyDefinitions}}{{#if @first}}{{surrogateKey}}{{/if}}{{/each}}] = link_table.[{{#each businessKeyDefinitions}}{{#if @first}}{{surrogateKey}}{{/if}}{{/each}}]
WHERE link_table.[{{#each businessKeyDefinitions}}{{#if @first}}{{surrogateKey}}{{/if}}{{/each}}] IS NULL
{{/if}}

{{/each}}